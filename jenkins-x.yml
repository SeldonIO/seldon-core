buildPack: none
pipelineConfig:
  pipelines:
    pullRequest:
      pipeline:
        agent:
          image: seldonio/core-builder:0.3
        stages:
          - name: build-and-test
            parallel:
              - name: end-to-end
                agent: 
                  image: seldonio/core-builder:0.4
                options:
                  containerOptions:
                    volumeMounts:
                      - mountPath: /var/run/docker.sock
                        name: docker-socket-volume
                    volumes:
                      - name: docker-socket-volume
                        hostPath:
                          path: /var/run/docker.sock
                          type: File
                steps:
                - name: test-end-to-end
                  command: make
                  args:
                    - -C testing/scripts
                    - s2i_build_base_images
                    - kind_create_cluster
                    - kind_setup
                    - test
              - name: seldon-python
                agent:
                  image: seldonio/python-builder:0.2
                steps:
                - name: test-python
                  command: make
                  args:
                    - -C python
                    - update_package
                    - install
                    - test
                - name: test-python-tf
                  command: make
                  args:
                    - -C python
                    - update_package
                    - install-tf
                    - test
              - name: seldon-engine
                agent:
                  image: seldonio/core-builder:0.3
                steps:
                - name: test-engine
                  command: make
                  args:
                  - -C engine
                  - -f Makefile.ci
                  - build_jar
